apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: rustfs
  namespace: argocd
  finalizers:
    - resources-finalizer.argocd.argoproj.io
spec:
  project: default
  source:
    repoURL: oci://registry-1.docker.io/cloudpirates
    targetRevision: 0.4.0
    chart: rustfs
    helm:
      values: |
        replicaCount: 1
        deploymentType: deployment
        config:
          address: "0.0.0.0:9000"
          consoleAddress: "0.0.0.0:9001"
          consoleEnabled: true
          volumes: "/data"
          logLevel: "info"
        auth:
          accessKey: rustfsadmin
          secretKey: rustfsadmin
        service:
          type: ClusterIP
          port: 9000
          consolePort: 9001
        ingress:
          enabled: false
        consoleIngress:
          enabled: false
        dataPersistence:
          enabled: true
          storageClass: local-path
          size: 3.5Ti
        logsPersistence:
          enabled: true
          storageClass: local-path
          size: 10Gi
        extraObjects:
          - apiVersion: v1
            kind: Service
            metadata:
              name: rustfs-console-nodeport
              namespace: rustfs
            spec:
              type: NodePort
              ports:
                - name: console
                  port: 9001
                  targetPort: console
                  nodePort: 30080
              selector:
                app.kubernetes.io/name: rustfs
                app.kubernetes.io/instance: rustfs
  destination:
    server: https://kubernetes.default.svc
    namespace: rustfs
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
