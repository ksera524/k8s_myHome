name: Deploy Process Validation

on:
  push:
    branches: [ main, master, develop ]
  pull_request:
    branches: [ main, master, develop ]

jobs:
  validate:
    runs-on: ubuntu-latest
    env:
      CI: "true"

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install validation tools
        run: |
          sudo apt-get update
          sudo apt-get install -y shellcheck
          python -m pip install --upgrade pip
          python -m pip install yamllint

      - name: Install kustomize
        run: |
          KUSTOMIZE_VERSION="v5.4.1"
          curl -sL "https://github.com/kubernetes-sigs/kustomize/releases/download/kustomize%2F${KUSTOMIZE_VERSION}/kustomize_${KUSTOMIZE_VERSION}_linux_amd64.tar.gz" \
            -o /tmp/kustomize.tar.gz
          tar -xzf /tmp/kustomize.tar.gz -C /tmp
          sudo mv /tmp/kustomize /usr/local/bin/kustomize
          kustomize version

      - name: Validate deployment assets
        run: automation/scripts/ci/validate.sh

      - name: Phase5 verify (CI safe)
        run: automation/scripts/verify.sh
